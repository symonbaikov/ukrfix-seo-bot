---
alwaysApply: true
---

1. Архитектура

Проект строго модульный.
Нельзя смешивать разную логику в одном файле.

Структура:
src/
  bot.py
  config.py
  seo_generator.py
  image_service.py
  wp_publisher.py
  google_context.py
  database.py
  scheduler.py
  utils/
    logger.py
    helpers.py
  models/
    category_map.py
    location_map.py
    constants.py

    Правила:
	•	В каждом модуле должна быть только одна зона ответственности.
	•	Функции не должны иметь side-effects вне модуля.
	•	Взаимодействие между модулями только через хорошо определённые функции.


    2. Работа с API

OpenAI
	•	Использовать только одну функцию-обёртку generate_article().
	•	Промпт хранится внутри seo_generator.py.
	•	Никаких “встроенных” промптов в коде других файлов.

Pexels
	•	Выносить API-запросы в image_service.py.
	•	При ошибке → логирование, возврат None.

WordPress
	•	Все публикации — только через wp_publisher.py.
	•	Нельзя отправлять запросы в WP из других модулей.
	•	Никаких “магических” URL — WP_URL из config.py.

⸻

3. ENV и конфиги

Все переменные должны обращаться через один модуль — config.py.

WP_URL
WP_USERNAME
WP_APP_PASSWORD
OPENAI_API_KEY
PEXELS_API_KEY


Никакие модули не должны работать с os.getenv() напрямую — только через функции в config.py.


4. База данных (SQLite)

Правила:
	•	Только один модуль отвечает за DB → database.py.
	•	Таблица: posted(country, city, category)
	•	Два метода:
    is_posted(country, city, category)
mark_posted(country, city, category)


	•	Никакая другая часть проекта не имеет прямого доступа к SQLite.



5. Логирование

Весь вывод — через utils/logger.py.

Нельзя использовать:

print()

Вместо этого:
from utils.logger import log
log("Working on:", category)


6. Генерация статей

Правила:
	•	Функция должна возвращать (title, html_content)
	•	Контент всегда генерируется в HTML
	•	Структура текста строго соответствует:
	•	Intro
	•	Попит
	•	Де шукати клієнтів
	•	Чому UkrFix
	•	Приклад оголошення
	•	Кнопка CTA

⸻

7. Главный цикл бота

Файл bot.py:
	•	Только бизнес-логика.
	•	Никаких API-вызовов — только вызовы модулей.
	•	Главная функция: main()

Последовательность:
	1.	load config
	2.	init DB
	3.	выбрать комбинацию
	4.	собрать контекст
	5.	получить фото
	6.	создать текст
	7.	опубликовать
	8.	записать в DB
	9.	sleep

⸻

8. Стиль кода
	•	Pythonic стиль, PEP8.
	•	Имена функций snake_case, классы — PascalCase.
	•	Файлы ≤ 300 строк.
	•	Любая сложная логика — выносится в helpers.py.

⸻

9. Ограничения для Cursor

Cursor запрещено:
	•	Переписывать модули полностью без запроса.
	•	Создавать новые зависимости без указания причины.
	•	Миксовать API и бизнес-логику.
	•	Вставлять ключи или конфиденциальные переменные.
	•	Удалять README, RULES.md или структуру проекта.

⸻

10. Как расширять проект

Все новые функции должны:
	1.	иметь понятный модуль
	2.	не ломать архитектуру
	3.	быть независимыми
	4.	быть покрытыми логами

Примеры расширений:
	•	Панель мониторинга
	•	Cron scheduler
	•	Webhook-уведомления
	•	Отчёты в телеграм